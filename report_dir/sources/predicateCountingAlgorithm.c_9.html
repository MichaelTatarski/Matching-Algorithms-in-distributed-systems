
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>predicateCountingAlgorithm.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">// This is a personal academic project. Dear PVS-Studio, please check it.</a>
<a name="ln2"> </a>
<a name="ln3">// PVS-Studio Static Code Analyzer for C, C++, C#, and Java: http://www.viva64.com</a>
<a name="ln4"> </a>
<a name="ln5">#include &quot;predicateCountingAlgorithm.h&quot;</a>
<a name="ln6"> </a>
<a name="ln7">int nameCompare(NameList *a, NameList *b)</a>
<a name="ln8">{</a>
<a name="ln9">    return strcmp(a-&gt;Name, b-&gt;Name);</a>
<a name="ln10">}</a>
<a name="ln11"> </a>
<a name="ln12">NameList *doesNameReferenceExist(char name[TEXT32], NameList *nameList)</a>
<a name="ln13">{</a>
<a name="ln14">    NameList *searchPointer = NULL;</a>
<a name="ln15">    NameList *likeElement;</a>
<a name="ln16">    likeElement = malloc(sizeof(NameList));</a>
<a name="ln17">    strcpy(likeElement-&gt;Name, name);</a>
<a name="ln18">    LL_SEARCH(nameList, searchPointer, likeElement, nameCompare);</a>
<a name="ln19">    return searchPointer;</a>
<a name="ln20">};</a>
<a name="ln21"> </a>
<a name="ln22">OperatorList *doesOperatorReferenceExist(Operator usedOperator, OperatorList *operatorList)</a>
<a name="ln23">{</a>
<a name="ln24">    OperatorList *searchPointer = NULL;</a>
<a name="ln25">    LL_SEARCH_SCALAR(operatorList, searchPointer, operator, usedOperator);</a>
<a name="ln26">    return searchPointer;</a>
<a name="ln27">};</a>
<a name="ln28"> </a>
<a name="ln29">ValueList *doesValueReferenceExist(Data usedValue, ValueList *valueList, DataType type)</a>
<a name="ln30">{</a>
<a name="ln31">    ValueList *searchPointer = NULL;</a>
<a name="ln32"> </a>
<a name="ln33">    if (type == INTEGER64)</a>
<a name="ln34">        LL_SEARCH_SCALAR(valueList, searchPointer, value.INTEGER64, usedValue.INTEGER64);</a>
<a name="ln35">    if (type == INTEGER32)</a>
<a name="ln36">        LL_SEARCH_SCALAR(valueList, searchPointer, value.INTEGER32, usedValue.INTEGER32);</a>
<a name="ln37">    if (type == DOUBLE)</a>
<a name="ln38">        LL_SEARCH_SCALAR(valueList, searchPointer, value.DOUBLE, usedValue.DOUBLE);</a>
<a name="ln39">    if (type == TEXT)</a>
<a name="ln40">        LL_SEARCH_SCALAR(valueList, searchPointer, value.TEXT, usedValue.TEXT);</a>
<a name="ln41"> </a>
<a name="ln42">    return searchPointer;</a>
<a name="ln43">};</a>
<a name="ln44"> </a>
<a name="ln45">NameList *createNameListElement(char name[TEXT32])</a>
<a name="ln46">{</a>
<a name="ln47">    NameList *newNameList = malloc(sizeof(NameList));</a>
<a name="ln48">    strcpy(newNameList-&gt;Name, name);</a>
<a name="ln49">    return newNameList;</a>
<a name="ln50">}</a>
<a name="ln51"> </a>
<a name="ln52">OperatorList *createOperatorListElement(Operator usedOperator)</a>
<a name="ln53">{</a>
<a name="ln54">    OperatorList *newOperatorList = malloc(sizeof(OperatorList));</a>
<a name="ln55">    newOperatorList-&gt;operator= usedOperator;</a>
<a name="ln56">    return newOperatorList;</a>
<a name="ln57">}</a>
<a name="ln58"> </a>
<a name="ln59">ValueList *createValueListElement(Data value, DataType type)</a>
<a name="ln60">{</a>
<a name="ln61">    ValueList *newValueList = malloc(sizeof(ValueList));</a>
<a name="ln62">    newValueList-&gt;isMatching = false;</a>
<a name="ln63">    if (type == INTEGER64)</a>
<a name="ln64">        newValueList-&gt;value.INTEGER64 = value.INTEGER64;</a>
<a name="ln65">    if (type == INTEGER32)</a>
<a name="ln66">        newValueList-&gt;value.INTEGER32 = value.INTEGER32;</a>
<a name="ln67">    if (type == DOUBLE)</a>
<a name="ln68">        newValueList-&gt;value.DOUBLE = value.DOUBLE;</a>
<a name="ln69">    if (type == TEXT)</a>
<a name="ln70">        strcpy(newValueList-&gt;value.TEXT, value.TEXT);</a>
<a name="ln71"> </a>
<a name="ln72">    return newValueList;</a>
<a name="ln73">}</a>
<a name="ln74"> </a>
<a name="ln75">ValueList *getReferenceForPredicate(Filter *filter, NameList *nameList)</a>
<a name="ln76">{</a>
<a name="ln77">    NameList *nameExist;</a>
<a name="ln78">    OperatorList *operatorExist;</a>
<a name="ln79">    ValueList *valueExist;</a>
<a name="ln80"> </a>
<a name="ln81">    Operator *operator= &amp;(filter-&gt;Operator);</a>
<a name="ln82">    char *name = filter-&gt;attribute.Name;</a>
<a name="ln83">    Data *value = malloc(sizeof(Data));</a>
<a name="ln84"> </a>
<a name="ln85">    if (filter-&gt;attribute.type == INTEGER64)</a>
<a name="ln86">        value-&gt;INTEGER64 = filter-&gt;attribute.data.INTEGER64;</a>
<a name="ln87">    if (filter-&gt;attribute.type == INTEGER32)</a>
<a name="ln88">        value-&gt;INTEGER32 = filter-&gt;attribute.data.INTEGER32;</a>
<a name="ln89">    if (filter-&gt;attribute.type == DOUBLE)</a>
<a name="ln90">        value-&gt;DOUBLE = filter-&gt;attribute.data.DOUBLE;</a>
<a name="ln91">    if (filter-&gt;attribute.type == TEXT)</a>
<a name="ln92">        strcpy(value-&gt;TEXT, name);</a>
<a name="ln93"> </a>
<a name="ln94">    nameExist = doesNameReferenceExist(name, nameList);</a>
<a name="ln95">    if (nameExist == NULL)</a>
<a name="ln96">        return NULL;</a>
<a name="ln97">    operatorExist = doesOperatorReferenceExist(*operator, nameExist-&gt;operatorListHead);</a>
<a name="ln98">    if (operatorExist == NULL)</a>
<a name="ln99">        return NULL;</a>
<a name="ln100">    valueExist = doesValueReferenceExist(*value, operatorExist-&gt;valueListHead, filter-&gt;attribute.type);</a>
<a name="ln101">    return valueExist;</a>
<a name="ln102">}</a>
<a name="ln103"> </a>
<a name="ln104">ValueList *insertNameAndOperatorAndValue(char *name, Operator *operator, Data value, DataType * type, NameList * nameList)</a>
<a name="ln105">{</a>
<a name="ln106">    ValueList *newValueListNode;</a>
<a name="ln107">    NameList *newNameListNode = createNameListElement(name);</a>
<a name="ln108">    OperatorList *newOperatorListNode = createOperatorListElement(*operator);</a>
<a name="ln109">    newValueListNode = createValueListElement(value, *type);</a>
<a name="ln110">    newNameListNode-&gt;operatorListHead = NULL;</a>
<a name="ln111">    newOperatorListNode-&gt;valueListHead = NULL;</a>
<a name="ln112"> </a>
<a name="ln113">    LL_APPEND(nameList, newNameListNode);</a>
<a name="ln114">    LL_APPEND(newNameListNode-&gt;operatorListHead, newOperatorListNode);</a>
<a name="ln115">    LL_APPEND(newOperatorListNode-&gt;valueListHead, newValueListNode);</a>
<a name="ln116">    return newValueListNode;</a>
<a name="ln117">}</a>
<a name="ln118"> </a>
<a name="ln119">ValueList *insertOperatorAndValue(NameList *nameExist, Operator *operator, Data value, DataType * type, NameList * nameList)</a>
<a name="ln120">{</a>
<a name="ln121">    ValueList *newValueListNode;</a>
<a name="ln122"> </a>
<a name="ln123">    OperatorList *newOperatorListNode = createOperatorListElement(*operator);</a>
<a name="ln124">    newValueListNode = createValueListElement(value, *type);</a>
<a name="ln125"> </a>
<a name="ln126">    newOperatorListNode-&gt;valueListHead = NULL;</a>
<a name="ln127"> </a>
<a name="ln128">    LL_APPEND(nameExist-&gt;operatorListHead, newOperatorListNode);</a>
<a name="ln129">    LL_APPEND(newOperatorListNode-&gt;valueListHead, newValueListNode);</a>
<a name="ln130">    return newValueListNode;</a>
<a name="ln131">}</a>
<a name="ln132"> </a>
<a name="ln133">ValueList *insertPredicate(Filter *filter, NameList *nameList)</a>
<a name="ln134">{</a>
<a name="ln135">    ValueList *newValueListNode;</a>
<a name="ln136">    Operator *operator= &amp;(filter-&gt;Operator);</a>
<a name="ln137">    char *name = filter-&gt;attribute.Name;</a>
<a name="ln138">    DataType *type = &amp;(filter-&gt;attribute.type);</a>
<a name="ln139">    Data value;</a>
<a name="ln140"> </a>
<a name="ln141">    NameList *nameExist;</a>
<a name="ln142">    OperatorList *operatorExist;</a>
<a name="ln143"> </a>
<a name="ln144">    if (*type == INTEGER64)</a>
<a name="ln145">        value.INTEGER64 = filter-&gt;attribute.data.INTEGER64;</a>
<a name="ln146">    if (*type == INTEGER32)</a>
<a name="ln147">        value.INTEGER32 = filter-&gt;attribute.data.INTEGER32;</a>
<a name="ln148">    if (*type == DOUBLE)</a>
<a name="ln149">        value.DOUBLE = filter-&gt;attribute.data.DOUBLE;</a>
<a name="ln150">    if (*type == TEXT)</a>
<a name="ln151">        strcpy(value.TEXT, name);</a>
<a name="ln152"> </a>
<a name="ln153">    nameExist = doesNameReferenceExist(name, nameList);</a>
<a name="ln154">    if (!nameExist)</a>
<a name="ln155">        return insertNameAndOperatorAndValue(name, operator, value, type, nameList);</a>
<a name="ln156"> </a>
<a name="ln157">    operatorExist = doesOperatorReferenceExist(*operator, nameExist-&gt;operatorListHead);</a>
<a name="ln158">    if (!operatorExist)</a>
<a name="ln159">        return insertOperatorAndValue(nameExist, operator, value, type, nameList);</a>
<a name="ln160"> </a>
<a name="ln161">    newValueListNode = createValueListElement(value, *type);</a>
<a name="ln162">    LL_APPEND(operatorExist-&gt;valueListHead, newValueListNode);</a>
<a name="ln163">    return NULL;</a>
<a name="ln164">}</a>
<a name="ln165"> </a>
<a name="ln166">ValueList *lookForPredicate(Filter *filter, NameList *nameList)</a>
<a name="ln167">{</a>
<a name="ln168">    ValueList *predicateReference = getReferenceForPredicate(filter, nameList);</a>
<a name="ln169">    if (predicateReference == NULL)</a>
<a name="ln170">        predicateReference = insertPredicate(filter, nameList);</a>
<a name="ln171">    return predicateReference;</a>
<a name="ln172">}</a>
<a name="ln173"> </a>
<a name="ln174">void startMatching(DataModel *dataModel, NameList *nameList)</a>
<a name="ln175">{</a>
<a name="ln176">    NameList *nameListElement;</a>
<a name="ln177">    ValueList *newValueListNode, *currentValue;</a>
<a name="ln178">    char *name = dataModel-&gt;DataModelHead-&gt;Name;</a>
<a name="ln179">    DataType *type = &amp;(dataModel-&gt;DataModelHead-&gt;type);</a>
<a name="ln180">    OperatorList *currentOperator;</a>
<a name="ln181"> </a>
<a name="ln182">    Data *value = malloc(sizeof(Data));</a>
<a name="ln183"> </a>
<a name="ln184">    if (*type == INTEGER64)</a>
<a name="ln185">        value-&gt;INTEGER64 = dataModel-&gt;DataModelHead-&gt;data.INTEGER64;</a>
<a name="ln186">    if (*type == INTEGER32)</a>
<a name="ln187">        value-&gt;INTEGER32 = dataModel-&gt;DataModelHead-&gt;data.INTEGER32;</a>
<a name="ln188">    if (*type == DOUBLE)</a>
<a name="ln189">        value-&gt;DOUBLE = dataModel-&gt;DataModelHead-&gt;data.DOUBLE;</a>
<a name="ln190">    if (*type == TEXT)</a>
<a name="ln191">        strcpy(value-&gt;TEXT, name);</a>
<a name="ln192"> </a>
<a name="ln193">    nameListElement = doesNameReferenceExist(name, nameList);</a>
<a name="ln194">    if (nameListElement)</a>
<a name="ln195">    {</a>
<a name="ln196">        currentOperator = nameListElement-&gt;operatorListHead;</a>
<a name="ln197">        while (currentOperator != NULL)</a>
<a name="ln198">        {</a>
<a name="ln199">            if (currentOperator-&gt;operator== EQUALS)</a>
<a name="ln200">            {</a>
<a name="ln201">                newValueListNode = doesValueReferenceExist(*value, currentOperator-&gt;valueListHead, *type);</a>
<a name="ln202">                if (newValueListNode)</a>
<a name="ln203">                    newValueListNode-&gt;isMatching = true;</a>
<a name="ln204">            }</a>
<a name="ln205"> </a>
<a name="ln206">            if (currentOperator-&gt;operator== GREATER_THAN)</a>
<a name="ln207">            {</a>
<a name="ln208">                currentValue = currentOperator-&gt;valueListHead;</a>
<a name="ln209">                while (currentValue != NULL)</a>
<a name="ln210">                {</a>
<a name="ln211">                    currentValue-&gt;isMatching = isGreaterThan(*type, currentValue-&gt;value, *value);</a>
<a name="ln212">                    currentValue = currentValue-&gt;next;</a>
<a name="ln213">                }</a>
<a name="ln214">            }</a>
<a name="ln215">            if (currentOperator-&gt;operator== GREATER_THAN_EQUAL)</a>
<a name="ln216">            {</a>
<a name="ln217">                currentValue = currentOperator-&gt;valueListHead;</a>
<a name="ln218">                while (currentValue != NULL)</a>
<a name="ln219">                {</a>
<a name="ln220">                    currentValue-&gt;isMatching = isGreaterThanEqual(*type, currentValue-&gt;value, *value);</a>
<a name="ln221">                    currentValue = currentValue-&gt;next;</a>
<a name="ln222">                }</a>
<a name="ln223">            }</a>
<a name="ln224">            if (currentOperator-&gt;operator== LESSER_THAN)</a>
<a name="ln225">            {</a>
<a name="ln226">                currentValue = currentOperator-&gt;valueListHead;</a>
<a name="ln227">                while (currentValue != NULL)</a>
<a name="ln228">                {</a>
<a name="ln229">                    currentValue-&gt;isMatching = isLesserThan(*type, currentValue-&gt;value, *value);</a>
<a name="ln230">                    currentValue = currentValue-&gt;next;</a>
<a name="ln231">                }</a>
<a name="ln232">            }</a>
<a name="ln233"> </a>
<a name="ln234">            if (currentOperator-&gt;operator== LESSER_THAN_EQUAL)</a>
<a name="ln235">            {</a>
<a name="ln236">                currentValue = currentOperator-&gt;valueListHead;</a>
<a name="ln237">                while (currentValue != NULL)</a>
<a name="ln238">                {</a>
<a name="ln239">                    currentValue-&gt;isMatching = isLesserThanEqual(*type, currentValue-&gt;value, *value);</a>
<a name="ln240">                    currentValue = currentValue-&gt;next;</a>
<a name="ln241">                }</a>
<a name="ln242">            }</a>
<a name="ln243"> </a>
<a name="ln244">            currentOperator = currentOperator-&gt;next;</a>
<a name="ln245">        }</a>
<a name="ln246">    }</a>
<a name="ln247">}</a>

</code></pre>
<div class="balloon" rel="17"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> There might be dereferencing of a potential null pointer 'likeElement'. Check lines: 17, 16.</p></div>
<div class="balloon" rel="38"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v550/" target="_blank">V550</a> An odd precise comparison. It's probably better to use a comparison with defined precision: fabs(A - B) < Epsilon.</p></div>
<div class="balloon" rel="48"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> There might be dereferencing of a potential null pointer 'newNameList'. Check lines: 48, 47.</p></div>
<div class="balloon" rel="55"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> There might be dereferencing of a potential null pointer 'newOperatorList'. Check lines: 55, 54.</p></div>
<div class="balloon" rel="62"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> There might be dereferencing of a potential null pointer 'newValueList'. Check lines: 62, 61.</p></div>
<div class="balloon" rel="86"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> There might be dereferencing of a potential null pointer 'value'. Check lines: 86, 83.</p></div>
<div class="balloon" rel="96"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v773/" target="_blank">V773</a> The function was exited without releasing the 'value' pointer. A memory leak is possible.</p></div>
<div class="balloon" rel="110"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> There might be dereferencing of a potential null pointer 'newNameListNode'.</p></div>
<div class="balloon" rel="111"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> There might be dereferencing of a potential null pointer 'newOperatorListNode'.</p></div>
<div class="balloon" rel="115"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> There might be dereferencing of a potential null pointer 'newValueListNode'.</p></div>
<div class="balloon" rel="126"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> There might be dereferencing of a potential null pointer 'newOperatorListNode'.</p></div>
<div class="balloon" rel="129"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> There might be dereferencing of a potential null pointer 'newValueListNode'.</p></div>
<div class="balloon" rel="162"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> There might be dereferencing of a potential null pointer 'newValueListNode'.</p></div>
<div class="balloon" rel="185"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v522/" target="_blank">V522</a> There might be dereferencing of a potential null pointer 'value'. Check lines: 185, 182.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
